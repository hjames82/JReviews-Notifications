<?php defined( 'MVC_FRAMEWORK') or die;  /** * The class name is the CamelCased filename */  class AdminJobsAlertEmailController extends MyController {    /**    * Autoloads Models in the array    * @var array    */    var $uses = array('category', 'criteria', 'directory', 'jreviews_category', 'field', 'field_option');    var $helpers = array('html', 'form', 'admin/admin_settings','editor');    var $components = array('config');   function beforeFilter()   {      parent::beforeFilter();   }     function index()   {      // We use an existing method in the Criteria model to get the Listing Types      $listingTypes = $this->Criteria->getSelectList();      $email_layout = Sanitize::getVar($this->Config, 'email_layout');      $email_listing_loop = Sanitize::getVar($this->Config, 'email_listing_loop');       if(preg_match('%\{JR_LISTING_LOOP\}%', $email_layout, $regs)){            $email_layout = preg_replace("%\{JR_LISTING_LOOP\}%", $email_listing_loop , $email_layout);        }      // Send the $listingTypes variable to the View      $this->set(array('listingTypes'=>$listingTypes,'emailLayout'=>$email_layout,'email_listing_loop'=>$email_listing_loop));      // Render the View      return $this->render('email','index');   }   function _save(){       $this->data['Config']['email_layout'] = html_entity_decode(Sanitize::getVar($this->data['__raw'],'email_layout'),ENT_QUOTES,cmsFramework::getCharset());       $this->data['Config']['email_listing_loop'] = html_entity_decode(Sanitize::getVar($this->data['__raw'],'email_listing_loop'),ENT_QUOTES,cmsFramework::getCharset());       $this->Config->store($this->data['Config']);   }}